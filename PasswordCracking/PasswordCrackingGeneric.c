#include <stdlib.h>
#include <netinet/in.h>
#include <stdio.h>
#include <signal.h>
#include <string.h>
#include <sys/socket.h>
#include <stdbool.h>
extern time_t time();

char *hashes[]={
#include "<NameOfFileContainingHashes>"
};

#define NUM_OF_WORDS (sizeof(word)/sizeof(word[0]))
#define MAXLEN 90
#define PASSCRACK_HARD_PORT <PortForThisExercise>

void easy1(int in, int out){
	char inputBuffer[MAXLEN], outputBuffer[MAXLEN];
	printf("Buffers Created...");
	//writting to socket
	sprintf(outputBuffer,"Welcome to Password Cracking.\n\n");
	write(out,outputBuffer,strlen(outputBuffer));
	for(int n = 0; n<(sizeof(hashes)/sizeof(hashes[0])); n++){
		sprintf(outputBuffer, "Hash #%d is: %s\n", n+1, hashes[n]);
		write(out,outputBuffer, strlen(outputBuffer));
	}
	sprintf(outputBuffer, "\nIf you think you cracked a hash, type your answer in the submissions website.\nHave fun!\n\n");
	write(out,outputBuffer, strlen(outputBuffer));
}

int main(int argc, char * argv[]){
	int sock, msgsock, client_len;
	struct sockaddr_in server, client;
	
	signal(SIGCHLD, SIG_IGN);	
	sock = socket(AF_INET, SOCK_STREAM, 0);
	if (sock < 0){
		perror("creating stream socket");
		exit(1);
	}
	
	server.sin_family		= AF_INET;
	server.sin_addr.s_addr 	= htonl(INADDR_ANY);
	server.sin_port			= htons(PASSCRACK_EASY1_PORT);
	
	if(bind(sock, (struct sokaddr *) &server, sizeof(server)) < 0){
		perror("binding socket");
		exit(2);
	}
	
	listen(sock, 5);
	fprintf(stderr, "Server listening...\n");
	
	while(1){
		client_len = sizeof(client);
		msgsock = accept(sock, (struct sockaddr *) &client, &client_len);
		if (msgsock < 0){
			perror("accepting connection");
			exit(3);
		}
		if (fork() == 0){
			close(sock);
			printf("new child (pid %d) using descriptor %d\n", getpid(), msgsock);
			srand((int)time((long *)0));
			easy1(msgsock, msgsock);
			printf("child (pid %d) exiting\n", getpid());
			exit(0);
		}
		else
			close(msgsock);
	}
}







