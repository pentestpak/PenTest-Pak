import socketserver
from pwn import *

class Handler(socketserver.BaseRequestHandler):
    def handle(self):
        p = process('./format')


        #send banner through socket
        self.request.sendall(p.recv())

        #Recieve exploit through socket
        response = self.request.recv(4096)
        print(response)

        #Send exploit to process
        p.sendline(response)

        #Get response from server
        self.request.sendall(p.recvuntil('flag:\n'))
        self.request.sendall(p.recv())
        self.request.sendall(p.recv())




def main():
    with socketserver.TCPServer(('0.0.0.0',2423), Handler) as server:
        server.serve_forever()

if __name__ == '__main__':
    main()